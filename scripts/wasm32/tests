#!/bin/bash
set -e
if [[ " $* " =~ " --relaxed " ]]; then
    export RELAXED_WARNINGS=1
fi
source "$(dirname "$0")/_env"

# Firefox headless doesn't support WebGPU by default, causing tests to fail with:
#   Can't request adapter: NotFound { active_backends: Backends(BROWSER_WEBGPU),
#   requested_backends: Backends(NOOP | VULKAN | GL | METAL | DX12), ... }
# Use Chrome which has WebGPU support
export CHROMEDRIVER=$(which chromedriver)

CARGO_TARGET_WASM32_UNKNOWN_UNKNOWN_RUNNER="wasm-bindgen-test-runner" RUSTFLAGS="$WASM32_RUSTFLAGS" RUSTDOCFLAGS="$WASM32_RUSTDOCFLAGS" cargo +nightly test --target=wasm32-unknown-unknown --all
